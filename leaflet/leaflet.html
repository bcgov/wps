<html>
  <head>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>
    <style type="text/css">
      #mapid {
        height: 640px;
      }
    </style>
  </head>
  <body>
    <div id="mapid"></div>
    model date:
    <div id="model_date"></div>
    prediction date:
    <div id="prediction_date"></div>
    <script type="text/javascript">
      var mymap = L.map("mapid").setView([0, 0], 1);
      const streetLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution:
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        }
      );
      streetLayer.addTo(mymap);

      const now = new Date();
      const year = now.getUTCFullYear();
      const month = (now.getUTCMonth() + 1).toString().padStart(2, "0");
      const day = now.getUTCDate().toString().padStart(2, "0");
      let hour = now.getUTCHours().toString().padStart(2, "0");
      hour = hour % 3 == 0 ? hour : hour - (hour % 3);
      const prediction_date = `${year}-${month}-${day}T${hour}:00:00.000Z`;

      const model_date = "2021-01-15T12:00:00.000Z";

      let xhr = new XMLHttpRequest();
      xhr.open("GET", "/api/c-haines/");
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.responseType = "json";
      xhr.onload = function () {
        if (xhr.status !== 200) return;
        const geoJsonLayer = L.geoJSON(xhr.response, {
          style: function (feature) {
            switch (feature.properties.severity) {
              case 1:
                return { color: "#ffff00" };
              case 2:
                return { color: "#ff0000" };
              case 3:
                return { color: "#800080" };
            }
          },
        });
        geoJsonLayer.addTo(mymap);
      };
      xhr.send();

      document.getElementById("prediction_date").innerText = prediction_date;
      document.getElementById("model_date").innerText = model_date;
    </script>
  </body>
</html>
