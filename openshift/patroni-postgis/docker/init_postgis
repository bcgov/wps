
if [[ (! -z "$APP_USER") &&  (! -z "$APP_PASSWORD") && (! -z "$APP_DATABASE") ]]; then
    echo "Loading PostGIS extensions into $APP_DATABASE"
    psql "$1" -w -c "\c ${APP_DATABASE}" -c "CREATE EXTENSION IF NOT EXISTS postgis;"
fi

if [[ (! -z "$NAME")]]; then
    echo "Initializing archive mode for pgbackrest"
    psql -c "alter system set archive_mode=on"
    psql -c "alter system set archive_command=pgbackrest --stanza="$NAME-cluster-1" archive-push %p"
    echo "Restarting postgres to init config"
    pg_ctlcluster $NAME restart
    echo "Creating pgbackrest stanza"
    pgbackrest --stanza="$NAME-cluster-1" --pg1-path=/home/postgres/pgdata/pgroot/data --pg1-port=5432 stanza-create
fi