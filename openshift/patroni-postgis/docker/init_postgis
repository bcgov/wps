
if [[ (! -z "$APP_USER") &&  (! -z "$APP_PASSWORD") && (! -z "$APP_DATABASE") && (! -z "$NAME") && (! -z "$PATRONI_POSTGRESQL_DATA_DIR")]]; then
    echo "Initializing archive mode for pgbackrest"
    psql -c "alter system set archive_mode=on;"
    psql -c "alter system set archive_command=pgbackrest --stanza=demo-cluster-1 archive-push '%p';"
    echo "Loading PostGIS extensions into $APP_DATABASE"
    psql "$1" -w -c "\c ${APP_DATABASE}" -c "CREATE EXTENSION IF NOT EXISTS postgis;"
    echo "Restarting postgres to init config"
    pg_ctl restart -D "$PATRONI_POSTGRESQL_DATA_DIR"
    echo "Creating pgbackrest stanza"
    pgbackrest --stanza="$NAME-cluster-1" --pg1-path="$PATRONI_POSTGRESQL_DATA_DIR" --pg1-port=5432 stanza-create
fi